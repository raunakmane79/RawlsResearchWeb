<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rawls Faculty Publications Database</title>

  <!-- Favicons (optional, keep yours if you have them) -->
  <meta name="theme-color" content="#ba0c2f" />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- XLSX Library -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --rawls-red:#ba0c2f;
      --bg:#f3f5f7;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      background: linear-gradient(#111 0px, #111 95px, var(--bg) 95px);
      color:var(--text);
    }

    /* Top bar */
    .topbar{
      height:95px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 24px;
      color:#fff;
    }
    .brand{
      display:flex; gap:14px; align-items:center;
      font-weight:700;
      letter-spacing:.2px;
    }
    .brand small{display:block; font-weight:400; opacity:.9; margin-top:2px}
    .actions{display:flex; gap:12px}
    .btn{
      border:1px solid rgba(255,255,255,.25);
      background:transparent;
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
    }
    .btn.primary{
      background:var(--rawls-red);
      border-color:transparent;
    }

    /* Page container */
    .wrap{
      max-width:1200px;
      margin: 28px auto 80px;
      padding: 0 18px;
    }

    .card{
      background:var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border:1px solid rgba(0,0,0,.04);
      overflow:hidden;
    }

    .cardHeader{
      padding: 28px 28px 8px;
      border-top:6px solid var(--rawls-red);
    }
    h1{
      margin:0;
      color:var(--rawls-red);
      font-size: 40px;
      letter-spacing:.2px;
    }
    .subtitleRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      margin-top:12px;
      color:var(--muted);
      font-weight:500;
    }

    .toolbar{
      padding: 12px 28px 18px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
      align-items:center;
    }
    .toolBtn{
      border:1px solid var(--border);
      background:#f9fafb;
      color:var(--text);
      padding:9px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .filters{
      padding: 16px 28px 22px;
    }
    .filterBox{
      border:1px solid var(--border);
      border-radius: 12px;
      padding:16px;
      background:#fff;
    }
    .filterTitle{
      font-weight:800;
      letter-spacing:.12em;
      color:#374151;
      font-size:14px;
    }
    .label{
      margin-top:12px;
      font-size:12px;
      color:#374151;
      font-weight:800;
      letter-spacing:.12em;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top:8px;
    }
    .row.two{
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }
    input, select{
      width:100%;
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus, select:focus{border-color:#c7cbd1; box-shadow:0 0 0 3px rgba(186,12,47,.10);}
    .checkRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
      color:#111827;
      font-weight:600;
      font-size:13px;
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .checkRow input{width:auto}

    /* Table */
    .tableWrap{
      border-top:1px solid var(--border);
      background:#fff;
    }
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      font-size:13px;
    }
    thead th{
      position:sticky;
      top:0;
      background:#fbfbfc;
      border-bottom:1px solid var(--border);
      color:#111827;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.08em;
      font-size:11px;
      padding:12px 10px;
      text-align:left;
    }
    tbody td{
      border-bottom:1px solid var(--border);
      padding:12px 10px;
      color:#111827;
      vertical-align:top;
    }
    tbody tr:hover{background:#fafafa}
    .linkBtn{
      border:1px solid var(--border);
      background:#fff;
      padding:7px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
    }
    .pill{
      display:inline-block;
      padding:3px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#f9fafb;
      font-weight:700;
      color:#374151;
      font-size:12px;
    }

    .footer{
      margin-top:40px;
      background:#111;
      color:#fff;
      padding:16px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight:600;
    }

    @media (max-width: 920px){
      .row.two{grid-template-columns: 1fr;}
      .toolbar{justify-content:flex-start; flex-wrap:wrap}
      h1{font-size:30px}
      .topbar{padding:0 14px}
      .wrap{padding:0 12px}
    }
  </style>
</head>

<body>

  <div class="topbar">
    <div class="brand">
      <div>
        <div style="font-size:20px;">Rawls College Research</div>
        <small>RAWLS COLLEGE OF BUSINESS · TEXAS TECH UNIVERSITY</small>
      </div>
    </div>
    <div class="actions">
      <button class="btn primary" onclick="window.open('#','_blank')">New Submission</button>
      <button class="btn" onclick="window.open('#','_blank')">Request Modification</button>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="cardHeader">
        <h1>Rawls Faculty Publications Database</h1>
        <div class="subtitleRow">
          <div id="resultsCount">Loading database…</div>
          <div>Research Built on Rawls.</div>
        </div>
      </div>

      <div class="toolbar">
        <button class="toolBtn" id="clearFilters">✕ Clear filters</button>
        <button class="toolBtn" id="exportExcel">⤓ Export</button>
      </div>

      <div class="filters">
        <div class="filterBox">
          <div class="filterTitle">SEARCH PUBLICATIONS</div>

          <div class="label">KEYWORD (TITLE / JOURNAL)</div>
          <div class="row">
            <input id="keywordSearch" placeholder="Search in title or journal" />
          </div>

          <div class="row two">
            <div>
              <div class="label">AUTHOR NAME</div>
              <input id="firstNameSearch" placeholder="First name" />
            </div>
            <div>
              <div class="label" style="opacity:0;">.</div>
              <input id="lastNameSearch" placeholder="Last name" />
            </div>
            <div>
              <div class="label">YEAR OF PUBLICATION</div>
              <select id="yearSearch">
                <option value="">All Years</option>
              </select>
              <div style="margin-top:6px;color:var(--muted);font-size:12px;">Filter by publication year.</div>
            </div>
          </div>

          <div class="checkRow">
            <input type="checkbox" id="exactNameMatch" />
            <label for="exactNameMatch">Match entire cell contents</label>
          </div>
        </div>
      </div>

      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>Last Name</th>
              <th>First Name</th>
              <th>Start Date at Rawls</th>
              <th>End Date at Rawls</th>
              <th>Position</th>
              <th>Area</th>
              <th>Pub Date</th>
              <th>Year</th>
              <th>Article Title</th>
              <th>Journal</th>
              <th>Rawls Journal List Ranking</th>
              <th>UTD</th>
              <th>Financial Times</th>
              <th>Author Rank</th>
              <th>Article Link</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>

    </div>
  </div>

  <div class="footer">
    <div>© 2025 Rawls College Research</div>
    <div><button class="btn primary" onclick="window.open('https://www.linkedin.com','_blank')">Follow us on LinkedIn</button></div>
  </div>

<script>
/* ---------------------- Robust Excel Loader ---------------------- */

let data = [];
let currentRows = [];

const els = {
  keywordSearch: document.getElementById("keywordSearch"),
  firstNameSearch: document.getElementById("firstNameSearch"),
  lastNameSearch: document.getElementById("lastNameSearch"),
  yearSearch: document.getElementById("yearSearch"),
  exactNameMatch: document.getElementById("exactNameMatch"),
  resultsBody: document.getElementById("resultsBody"),
  resultsCount: document.getElementById("resultsCount"),
  clearFilters: document.getElementById("clearFilters"),
  exportExcel: document.getElementById("exportExcel"),
};

function canon(str) {
  return String(str || "")
    .toLowerCase()
    .replace(/\u00a0/g, " ")          // non-breaking spaces
    .replace(/\s+/g, " ")
    .replace(/[^a-z0-9 ]/g, "")      // remove punctuation (hyphens etc.)
    .trim();
}

function normalizeRow(row) {
  const norm = {};
  Object.keys(row).forEach(k => norm[canon(k)] = row[k]);
  return norm;
}

function findBestSheet(workbook) {
  // canonical headers we need (matches YOUR backend excel columns)
  const target = [
    "lastname","firstname","start date at rawls","end date at rawls","position","area",
    "pubdate","year","articletitle","journalname",
    "ranking updated","utd journal","financial times journal",
    "author rank","article link"
  ];

  let best = workbook.SheetNames[0];
  let bestScore = -1;

  for (const name of workbook.SheetNames) {
    const sheet = workbook.Sheets[name];
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, range: 0, blankrows: false });
    const header = rows[0] || [];
    const set = new Set(header.map(canon));
    const score = target.filter(h => set.has(h)).length;
    if (score > bestScore) { bestScore = score; best = name; }
  }
  console.log("Chosen sheet:", best, "score:", bestScore);
  return best;
}

async function loadWorkbook() {
  // IMPORTANT: must match your file name exactly in the same folder as index.html
  const fileName = "Database.xlsx";

  const res = await fetch(fileName, { cache: "no-store" });
  if (!res.ok) throw new Error(`Failed to fetch ${fileName}. Status: ${res.status}`);

  const arrayBuffer = await res.arrayBuffer();
  const workbook = XLSX.read(arrayBuffer, { type: "array" });

  const sheetName = findBestSheet(workbook);
  const sheet = workbook.Sheets[sheetName];

  // Parse into objects
  const rawRows = XLSX.utils.sheet_to_json(sheet, { defval: "" });

  data = rawRows.map(row => {
    const r = normalizeRow(row);

    return {
      lastName: String(r["lastname"] || "").trim(),
      firstName: String(r["firstname"] || "").trim(),
      startDate: String(r["start date at rawls"] || "").trim(),
      endDate: String(r["end date at rawls"] || "").trim(),
      position: String(r["position"] || "").trim(),
      area: String(r["area"] || "").trim(),
      pubDate: String(r["pubdate"] || "").trim(),
      year: String(r["year"] || "").trim(),
      articleTitle: String(r["articletitle"] || "").trim(),
      journalName: String(r["journalname"] || "").trim(),
      ranking: String(r["ranking updated"] || "").trim(),
      utd: String(r["utd journal"] || "").trim(),
      financialTimes: String(r["financial times journal"] || "").trim(),
      authorRank: String(r["author rank"] || "").trim(),
      articleLink: String(r["article link"] || "").trim(),
    };
  }).filter(r => Object.values(r).some(v => String(v).trim() !== ""));

  console.log("Loaded rows:", data.length, data[0]);

  populateYearDropdown();
  applyFilters();
}

/* ---------------------- UI / Filters ---------------------- */

function populateYearDropdown() {
  const years = Array.from(new Set(data.map(d => d.year).filter(Boolean)))
    .sort((a,b) => Number(b) - Number(a));

  els.yearSearch.innerHTML = `<option value="">All Years</option>` +
    years.map(y => `<option value="${escapeHtml(y)}">${escapeHtml(y)}</option>`).join("");
}

function escapeHtml(s) {
  return String(s || "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function normText(s){ return String(s || "").toLowerCase().trim(); }

function matchesText(value, query, exact) {
  const v = normText(value);
  const q = normText(query);
  if (!q) return true;
  if (exact) return v === q;
  return v.includes(q);
}

function applyFilters() {
  const kw = els.keywordSearch.value.trim();
  const fn = els.firstNameSearch.value.trim();
  const ln = els.lastNameSearch.value.trim();
  const year = els.yearSearch.value.trim();
  const exact = els.exactNameMatch.checked;

  currentRows = data.filter(r => {
    const keywordOk = !kw || (
      normText(r.articleTitle).includes(normText(kw)) ||
      normText(r.journalName).includes(normText(kw))
    );

    const firstOk = matchesText(r.firstName, fn, exact);
    const lastOk  = matchesText(r.lastName, ln, exact);
    const yearOk  = !year || String(r.year).trim() === year;

    return keywordOk && firstOk && lastOk && yearOk;
  });

  renderTable(currentRows);
  els.resultsCount.textContent = `Showing ${currentRows.length} results`;
}

function renderTable(rows) {
  els.resultsBody.innerHTML = rows.map(r => {
    const linkCell = r.articleLink
      ? `<button class="linkBtn" data-link="${escapeHtml(r.articleLink)}">Open</button>`
      : `<span class="pill">N/A</span>`;

    return `
      <tr>
        <td>${escapeHtml(r.lastName)}</td>
        <td>${escapeHtml(r.firstName)}</td>
        <td>${escapeHtml(r.startDate)}</td>
        <td>${escapeHtml(r.endDate)}</td>
        <td>${escapeHtml(r.position)}</td>
        <td>${escapeHtml(r.area)}</td>
        <td>${escapeHtml(r.pubDate)}</td>
        <td>${escapeHtml(r.year)}</td>
        <td>${escapeHtml(r.articleTitle)}</td>
        <td>${escapeHtml(r.journalName)}</td>
        <td>${escapeHtml(r.ranking)}</td>
        <td>${escapeHtml(r.utd)}</td>
        <td>${escapeHtml(r.financialTimes)}</td>
        <td>${escapeHtml(r.authorRank)}</td>
        <td>${linkCell}</td>
      </tr>
    `;
  }).join("");
}

// Article link button handler (delegation)
document.addEventListener("click", (e) => {
  const btn = e.target.closest(".linkBtn");
  if (!btn) return;
  const url = btn.getAttribute("data-link") || "";
  if (!url) return;
  window.open(url, "_blank", "noopener,noreferrer");
});

/* ---------------------- Buttons ---------------------- */

els.clearFilters.addEventListener("click", () => {
  els.keywordSearch.value = "";
  els.firstNameSearch.value = "";
  els.lastNameSearch.value = "";
  els.yearSearch.value = "";
  els.exactNameMatch.checked = false;
  applyFilters();
});

els.exportExcel.addEventListener("click", () => {
  const exportRows = currentRows.map(r => ({
    "Lastname": r.lastName,
    "Firstname": r.firstName,
    "Start Date at Rawls": r.startDate,
    "End date at Rawls": r.endDate,
    "Position": r.position,
    "Area": r.area,
    "pubdate": r.pubDate,
    "year": r.year,
    "articletitle": r.articleTitle,
    "journalname": r.journalName,
    "Ranking - Updated": r.ranking,
    "UTD Journal": r.utd,
    "Financial Times Journal": r.financialTimes,
    "Author Rank": r.authorRank,
    "Article Link": r.articleLink
  }));

  const ws = XLSX.utils.json_to_sheet(exportRows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Filtered Results");
  XLSX.writeFile(wb, "Rawls_Publications_Filtered.xlsx");
});

/* ---------------------- Live filter events ---------------------- */

["input","change"].forEach(evt => {
  els.keywordSearch.addEventListener(evt, applyFilters);
  els.firstNameSearch.addEventListener(evt, applyFilters);
  els.lastNameSearch.addEventListener(evt, applyFilters);
  els.yearSearch.addEventListener(evt, applyFilters);
  els.exactNameMatch.addEventListener(evt, applyFilters);
});

/* ---------------------- Start ---------------------- */
(async function init(){
  try {
    await loadWorkbook();
  } catch (err) {
    console.error(err);
    els.resultsCount.textContent =
      "❌ Database failed to load. Make sure 'Backend database.xlsx' is in the same folder as this page.";
  }
})();
</script>

</body>
</html>

   
